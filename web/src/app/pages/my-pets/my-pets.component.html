<div class="my-pets-page">
  <div class="container">
    <div class="page-header">
      <h1>Mis Mascotas</h1>
      <p>Gestiona la información y el historial médico de tus mascotas</p>
    </div>

    @if (isLoading) {
      <div class="loading">
        <div class="spinner"></div>
        <p>Cargando mascotas...</p>
      </div>
    } @else if (pets.length === 0) {
      <div class="empty-state">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M4.5 9.5m-2.5 0a2.5 2.5 0 1 0 5 0a2.5 2.5 0 1 0-5 0M9 5.5m-2.5 0a2.5 2.5 0 1 0 5 0a2.5 2.5 0 1 0-5 0m6.5 4m-2.5 0a2.5 2.5 0 1 0 5 0a2.5 2.5 0 1 0-5 0M5.5 15c-2.5 0-4.5 1.8-4.5 4v1h9v-1c0-2.2-2-4-4.5-4m9-4c-2.5 0-4.5 1.8-4.5 4v1h9v-1c0-2.2-2-4-4.5-4z"/>
        </svg>
        <h2>No tienes mascotas registradas</h2>
        <p>Las mascotas se registran durante tu primera visita a la clínica</p>
        <a routerLink="/appointments" class="btn-primary">Agendar Primera Cita</a>
      </div>
    } @else {
      <div class="pets-grid">
        @for (pet of pets; track pet.id) {
          <div class="pet-card">
            <div class="pet-photo">
              @if (pet.photo_url) {
                <img [src]="pet.photo_url" [alt]="pet.name">
              } @else {
                <div class="photo-placeholder">
                  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
                    <path d="M4.5 9.5m-2.5 0a2.5 2.5 0 1 0 5 0a2.5 2.5 0 1 0-5 0M9 5.5m-2.5 0a2.5 2.5 0 1 0 5 0a2.5 2.5 0 1 0-5 0m6.5 4m-2.5 0a2.5 2.5 0 1 0 5 0a2.5 2.5 0 1 0-5 0M5.5 15c-2.5 0-4.5 1.8-4.5 4v1h9v-1c0-2.2-2-4-4.5-4m9-4c-2.5 0-4.5 1.8-4.5 4v1h9v-1c0-2.2-2-4-4.5-4z"/>
                  </svg>
                </div>
              }
            </div>
            <div class="pet-info">
              <h3>{{ pet.name }}</h3>
              <div class="pet-details">
                <span class="detail">
                  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
                    <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 3c1.66 0 3 1.34 3 3s-1.34 3-3 3-3-1.34-3-3 1.34-3 3-3zm0 14.2c-2.5 0-4.71-1.28-6-3.22.03-1.99 4-3.08 6-3.08 1.99 0 5.97 1.09 6 3.08-1.29 1.94-3.5 3.22-6 3.22z"/>
                  </svg>
                  {{ pet.species }} - {{ pet.breed }}
                </span>
                <span class="detail">
                  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
                    <path d="M19 4h-1V2h-2v2H8V2H6v2H5c-1.11 0-1.99.9-1.99 2L3 20c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zm0 16H5V10h14v10z"/>
                  </svg>
                  {{ getAge(pet.birth_date) }}
                </span>
                <span class="detail">
                  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
                    <path d="M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7zm0 9.5c-1.38 0-2.5-1.12-2.5-2.5s1.12-2.5 2.5-2.5 2.5 1.12 2.5 2.5-1.12 2.5-2.5 2.5z"/>
                  </svg>
                  {{ pet.weight }} kg
                </span>
              </div>
              <button class="btn-view-history" (click)="viewHistory(pet)">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
                  <path d="M14 2H6c-1.1 0-1.99.9-1.99 2L4 20c0 1.1.89 2 1.99 2H18c1.1 0 2-.9 2-2V8l-6-6zm2 16H8v-2h8v2zm0-4H8v-2h8v2zm-3-5V3.5L18.5 9H13z"/>
                </svg>
                Ver Historial Médico
              </button>
            </div>
          </div>
        }
      </div>
    }
  </div>

  <!-- Modal de Historial Médico -->
  @if (showHistory && selectedPet) {
    <div class="modal-overlay" (click)="closeHistory()">
      <div class="modal-content" (click)="$event.stopPropagation()">
        <div class="modal-header">
          <h2>Historial Médico de {{ selectedPet.name }}</h2>
          <button class="btn-close" (click)="closeHistory()">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
              <path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/>
            </svg>
          </button>
        </div>
        <div class="modal-body">
          @if (selectedPet.medical_history && selectedPet.medical_history.length > 0) {
            <div class="history-timeline">
              @for (record of selectedPet.medical_history; track record.id) {
                <div class="history-item">
                  <div class="history-date">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
                      <path d="M19 4h-1V2h-2v2H8V2H6v2H5c-1.11 0-1.99.9-1.99 2L3 20c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zm0 16H5V10h14v10z"/>
                    </svg>
                    {{ record.date | date: 'dd/MM/yyyy' }}
                  </div>
                  <div class="history-content">
                    <h4>{{ record.diagnosis }}</h4>
                    <p class="treatment"><strong>Tratamiento:</strong> {{ record.treatment }}</p>
                    <p class="vet"><strong>Veterinario:</strong> {{ record.veterinarian }}</p>
                    @if (record.observations) {
                      <p class="observations"><strong>Observaciones:</strong> {{ record.observations }}</p>
                    }
                  </div>
                </div>
              }
            </div>
          } @else {
            <div class="no-history">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
                <path d="M14 2H6c-1.1 0-1.99.9-1.99 2L4 20c0 1.1.89 2 1.99 2H18c1.1 0 2-.9 2-2V8l-6-6zm2 16H8v-2h8v2zm0-4H8v-2h8v2zm-3-5V3.5L18.5 9H13z"/>
              </svg>
              <p>No hay registros médicos para esta mascota</p>
            </div>
          }
        </div>
      </div>
    </div>
  }
</div>
